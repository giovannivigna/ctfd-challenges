#!/usr/bin/env python3
from pwn import *
import sys
import os

def main():
    if len(sys.argv) != 4:
        print(f"Usage: {sys.argv[0]} <host> <port> <file>")
        sys.exit(1)

    host = sys.argv[1]
    port = int(sys.argv[2])
    file_path = sys.argv[3]

    # Ensure file exists
    if not os.path.isfile(file_path):
        print(f"[!] File not found: {file_path}")
        sys.exit(1)

    # Read the file contents
    with open(file_path, 'rb') as f:
        payload = f.read()

    payload_length = len(payload)

    # Connect to the remote service
    conn = remote(host, port)

    # Step 1: Wait for length prompt
    conn.recvuntil(b'Enter your payload length:')

    # Step 2: Send length as string (with newline)
    conn.sendline(str(payload_length).encode())

    # Step 3: Wait for payload prompt
    conn.recvuntil(b'Enter your payload:')

    # Step 4: Send the file content (exactly as read, binary safe)
    conn.send(payload)

    # Optional: Receive and print response (or handle it if needed)
    response = conn.recvall(timeout=2)
    print(response.decode(errors='ignore'))

    # Close the connection
    conn.close()

if __name__ == '__main__':
    main()